<!DOCTYPE html>
<html lang="cn-Hans">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="前言在 Android 中提供了这样一个特殊的控件 WebView，用于显示网页。也属于网络编程中的一部分，所以这次就来学习一下 WebView 的相关用法。
最基本用法WebView 最基本的用法可以分为以下三步：

在 layout 文件中添加 WebView 控件：

1234567&amp;lt;?">
    

    <!--Author-->
    
        <meta name="author" content="Owen Lee">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Android 网络编程系列（三）WebView 的使用"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="海树"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

        <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>Android 网络编程系列（三）WebView 的使用 - 海树</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


    <!-- favicon -->
    
	
</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">海树</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                主页
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives">
                            
                                归档
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('http://image.wufazhuce.com/FpTKCypCWlsfDgMlkAG8q62aOK1l')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Android 网络编程系列（三）WebView 的使用</h1>
                    
                    <h2 class="post-subheading">
                        介绍一下 WebView 的简单用法
                    </h2>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                        2017-10-16
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                    
                        


<a href="/tags/Android-网络编程/">#Android 网络编程</a>


                    
                </div>
                <div class="col-lg-4 col-md-5 post-categories">
                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>在 Android 中提供了这样一个特殊的控件 WebView，用于显示网页。也属于网络编程中的一部分，所以这次就来学习一下 WebView 的相关用法。</p>
<h3 id="最基本用法"><a href="#最基本用法" class="headerlink" title="最基本用法"></a>最基本用法</h3><p>WebView 最基本的用法可以分为以下三步：</p>
<ol>
<li>在 layout 文件中添加 WebView 控件：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;WebView  </div><div class="line">	xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:id=&quot;@+id/webview&quot;</div><div class="line">    android:layout_width=&quot;fill_parent&quot;</div><div class="line">    android:layout_height=&quot;fill_parent&quot;</div><div class="line">/&gt;</div></pre></td></tr></table></figure>
<ol>
<li>调用 WebView 的 loadUrl() 方法，传入要显示的网址：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">WebView mWebView = (WebView) findViewById(R.id.webview);</div><div class="line">mWebView.loadUrl(&quot;http://www.baidu.com&quot;);</div></pre></td></tr></table></figure>
<ol>
<li>在 AndroidManifest.xml 文件中添加网络访问的权限：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;manifest ... &gt;</div><div class="line">    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</div><div class="line">    ...</div><div class="line">&lt;/manifest&gt;</div></pre></td></tr></table></figure>
<p>通过以上三个步骤，就已经可以使用 WebView 了。接下来再介绍一下 WebView 的更进一步的内容。</p>
<h3 id="WebView-支持-JavaScript"><a href="#WebView-支持-JavaScript" class="headerlink" title="WebView 支持 JavaScript"></a>WebView 支持 JavaScript</h3><p>WebView 默认是不支持 JS 的，我们可以通过手动修改设置来让 WebView 支持 JS。通过 getSettings() 法获取到 WebSettings 这个类的实例，这个类是专门用于<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">//设置支持JS</div><div class="line">WebSettings webSettings = mWebView.getSettings();</div><div class="line">webSettings.setJavaScriptEnabled(true);</div></pre></td></tr></table></figure></p>
<h3 id="WebView-页面处理"><a href="#WebView-页面处理" class="headerlink" title="WebView 页面处理"></a>WebView 页面处理</h3><p>但是在加载网页时，Android 默认是需要调用本机中浏览器来打开网页，而不是直接在本应用中展示。如果想在应用中直接展示网页，就需要重写 WebViewClient 类中的 <strong>shouldOverrideUrlLoading()</strong> 方法，return true 表示使用 WebView 直接展示网页。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//设置在当前应用中直接展示网页</div><div class="line">mWebView.setWebViewClient(new MyWebViewClient());</div><div class="line"></div><div class="line">class MyWebViewClient extends WebViewClient&#123;</div><div class="line">    @Override</div><div class="line">    public boolean shouldOverrideUrlLoading(WebView view, </div><div class="line">		    String url) &#123;</div><div class="line">        view.loadUrl(url);</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="WebView-历史记录"><a href="#WebView-历史记录" class="headerlink" title="WebView 历史记录"></a>WebView 历史记录</h3><p>WebView 自身维护了一个浏览历史记录的列表，但是在 WebView 中点击返回键时，当前页面不管是不是能够返回上一页，都会直接退出 WebView。如果想实现和浏览器中一样的到上一页、下一页的效果就需要借助 WebView 的 goBack() 、goForword() 方法，同时重写返回键的处理逻辑。</p>
<p>先来看看相关的方法说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">boolean canGoBack ()</div><div class="line">判断此WebView是否可以回到上一页</div><div class="line">boolean cangGoForward ()</div><div class="line">判断此WebView是否可以到下一页</div><div class="line">boolean canGoBackOrForward (int steps)</div><div class="line">通过传进来的参数判断是否能够到达指定的页面，参数为负表示回到上n页，为正表示去下n页</div><div class="line"></div><div class="line">void goBack ()</div><div class="line">回到上一页</div><div class="line">void goForword ()</div><div class="line">去到下一页</div><div class="line">void goBackOrForward (int steps)</div><div class="line">回到上n页或者去到下n页，steps为负表示后退，为正表示前进</div><div class="line"></div><div class="line">void clearHistory ()</div><div class="line">清除所有的历史纪录</div></pre></td></tr></table></figure>
<p>实例代码如下，当按下返回键并且 WebView 可以回到上一页时，就返回到上一页，否则就按默认逻辑处理：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Override</div><div class="line">public boolean onKeyDown(int keyCode, KeyEvent event) &#123;</div><div class="line">    if ((keyCode == KeyEvent.KEYCODE_BACK) </div><div class="line">		    &amp;&amp; mWebView.canGoBack()) &#123;</div><div class="line">        mWebView.goBack();</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line">    return super.onKeyDown(keyCode, event);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="JS代码调用本地Java代码"><a href="#JS代码调用本地Java代码" class="headerlink" title="JS代码调用本地Java代码"></a>JS代码调用本地Java代码</h3><p>WebView 支持使用 addJavaScriptInterface() 方法来让 JavaScript 调用 App 中的原生 Java 代码，比如在网页中弹出一个原生的对话框代替网页中的 Alert。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">void addJavascriptInterface (Object object, String name)</div><div class="line">该方法的原理是将一个Java对象以指定的变量名字（代码中的name）注入到JS的上下文中，这个时候这个变量在JS中可以用于表示那个Java对象，从而调用该对象的方法。</div></pre></td></tr></table></figure></p>
<p>首先需要在 Java 代码中创建一个 JavaScriptInterface，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">class MyJSInterface&#123;</div><div class="line">	private Context mContext;</div><div class="line">	public MyInterface(Context context)&#123;</div><div class="line">		this.mContext = context;</div><div class="line">	&#125;</div><div class="line">	@JavascriptInterface</div><div class="line">	public void showToast(String text)&#123;</div><div class="line">	Toast.makeText(mContext, text, 1000).show();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>之后调用 WebView 的 addJavaScriptInterface() 方法，传入上面这个“接口”类的实例和在 JS 中变量名称：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mWebView.addJavascriptInterface (new MyJSInterface(this), </div><div class="line">		&quot;android&quot;);</div></pre></td></tr></table></figure>
<p>让我们看看在 HTML 页面中是如何调用到 Java代码的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;html&gt;</div><div class="line">  &lt;head&gt; </div><div class="line">    &lt;meta charset=&quot;utf-8&quot;&gt; </div><div class="line">    &lt;title&gt;JSDemo&lt;/title&gt; </div><div class="line">    &lt;script&gt;</div><div class="line">       function toast(msg) &#123;</div><div class="line">         window.android.showToast(msg)</div><div class="line">       &#125;</div><div class="line">    &lt;/script&gt;</div><div class="line">  &lt;/head&gt;</div><div class="line">  &lt;body&gt;</div><div class="line">    &lt;button type=&quot;button&quot; id=&quot;btn_toast&quot; </div><div class="line">        onclick=&quot;toast(&apos;show a Toast&apos;)&quot;&gt;</div><div class="line">      toast</div><div class="line">    &lt;/button&gt;</div><div class="line">  &lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<p>可以看到在 HTML 页面上有一个按钮，点击这个按钮就会执行 JS 中的 toast() 方法，在这个方法里面就是调用了 window.android.showToast() 方法。</p>
<p>使用 addJavaScriptInterface() 需要注意以下几点：</p>
<ol>
<li><p>addJavascriptInterface() 方法中要绑定的 Java 对象及方法要运行另外的线程中，不能运行在构造它的线程中。</p>
</li>
<li><p>使用这个方法在 Android 4.2 以下的版本中会存在安全隐患，4.2 以下的版本没有对注册 Java 类的方法调用进行限制，所以 JavaScript 可以使用反射来访问注入对象的公共字段，以及其他任何没有注册的 Java 类。攻击者可以通过这一漏洞对客户端为所欲为，包括盗取个人隐私资料等。</p>
</li>
<li><p>在 Android 4.2（targetSdkVersion ≥ 17）以上的版本中这个漏洞被解决，在注册 Java 对象需要调用的方法前必须加上<strong>@JavascriptInterface</strong>这个注解，否则 JS 代码不能调用该方法。</p>
</li>
</ol>
<h3 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h3><p>就先写这些吧。这篇文章写了很久，但还是没写好。因为其实并没有讲的很深入，只是介绍了一些皮毛，我自己的理解也还没到位。下一篇文章努力做的更好一点，还是关于 WebView。</p>
<p>下次见。</p>
<h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><p>照例贴一下在学习过程中看过的一些优秀的博客，真的从中学到了很多的东西。</p>
<blockquote>
<p><a href="https://developer.android.google.cn/reference/android/webkit/WebView.html" target="_blank" rel="external">https://developer.android.google.cn/reference/android/webkit/WebView.html</a><br>谷歌开发者官网：WebView<br><a href="http://jaq.alibaba.com/blog.htm?id=48" target="_blank" rel="external">http://jaq.alibaba.com/blog.htm?id=48</a><br>阿里无线安全平台：WebView 远程代码执行漏洞浅析<br><a href="http://www.jianshu.com/p/e3965d3636e7" target="_blank" rel="external">http://www.jianshu.com/p/e3965d3636e7</a><br>谈谈WebView的使用（作者的想法很好）<br><a href="https://www.kymjs.com/code/2015/05/03/01/" target="_blank" rel="external">https://www.kymjs.com/code/2015/05/03/01/</a><br><a href="https://kymjs.com/code/2015/05/04/01/" target="_blank" rel="external">https://kymjs.com/code/2015/05/04/01/</a><br>张涛：深入讲解WebView（上、下）</p>
</blockquote>


                
            </div>

            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    


                </div>
            
        </div>
    </div>
</article>

    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    

                    

                    
                        <li>
                            <a href="https://github.com/weiyushiguang" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    

                    
                </ul>
                <p class="copyright text-muted">&copy; 2017 Owen Lee<br></p>
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->



</body>

</html>