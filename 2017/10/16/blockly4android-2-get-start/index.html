<!DOCTYPE html>
<html lang="cn-Hans">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="申明本文翻译自Google Blockly 官方文档。

这份指南适用于那些希望将 Blockly 作为代码编辑器来进行 App 开发的 Android 开发者。在阅读这份指南之前，我们希望你对 Blockly 的用法有一定了解，并且知道如何使用 Android Studio 进行 App 的开发。">
    

    <!--Author-->
    
        <meta name="author" content="Owen Lee">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Blockly4Android 开发指南（2）开始使用 Blockly"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="海树"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

        <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>Blockly4Android 开发指南（2）开始使用 Blockly - 海树</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


    <!-- favicon -->
    
	
</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">海树</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                主页
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives">
                            
                                归档
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('http://image.wufazhuce.com/FrkK_wENKb7emv-OTFGkNN0TVbYf')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Blockly4Android 开发指南（2）开始使用 Blockly</h1>
                    
                    <h2 class="post-subheading">
                        翻译的 Google Blockly 官方文档第二篇
                    </h2>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                        2017-10-16
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                    
                        


<a href="/tags/Blockly4Android/">#Blockly4Android</a>


                    
                </div>
                <div class="col-lg-4 col-md-5 post-categories">
                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <h3 id="申明"><a href="#申明" class="headerlink" title="申明"></a>申明</h3><p>本文翻译自Google Blockly 官方文档。</p>
<hr>
<p>这份指南适用于那些希望将 Blockly 作为代码编辑器来进行 App 开发的 Android 开发者。在阅读这份指南之前，我们希望你对 Blockly 的用法有一定了解，并且知道如何使用 Android Studio 进行 App 的开发。</p>
<p>在 Android 应用中使用 Blockly 的基本步骤是：</p>
<ol>
<li>创建工程并且配置 Activity</li>
<li>配置项目依赖</li>
<li>继承 AbstractBlocklyActivity 并实现必要的方法</li>
</ol>
<p>当你完成上述三步，你的应用程序会和 Blockly 官方 Demo 的基本效果一致，得到一个包含许多 Block 的工具箱（toolbox）和一个大工作区（workspace），如图所示：<br><img src="http://opgrjw8x2.bkt.clouddn.com/17-10-16/21590055.jpg" alt="enter image description here"></p>
<h3 id="创建工程和-Activity"><a href="#创建工程和-Activity" class="headerlink" title="创建工程和 Activity"></a>创建工程和 Activity</h3><p>如果你还没有创建工程，就在 Android Studio 中用「Empty Activity」模板创建一个新的工程。Blockly 需要项目的 minSdkVersion 大于或等于18。如果你已经有了一个工程，就在添加一个「Empty Activity」到已有的工程中。</p>
<p><img src="http://opgrjw8x2.bkt.clouddn.com/17-10-16/89704981.jpg" alt="enter image description here"></p>
<p>这两种情况下，你都不需要为你的 Blockly Activity 创建对应的布局文件，它会自动使用 Blockly 库中提供的布局文件。</p>
<p>在 AndroidManifest.xml 文件中，像如下代码一样设置 <strong>windowSoftInputMode</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;application ...</div><div class="line">    android:windowSoftInputMode=&quot;stateHidden|adjustPan&quot;</div><div class="line">    /&gt;</div></pre></td></tr></table></figure>
<p>这样设置 windowSoftInputMode 确保即使在有输入框的情况下，键盘都处于隐藏状态。当键盘（或其他输入法编辑器 Input Method Editor）出现时，它还将确保工作区平移以显示这些区域。</p>
<p>AndroidManifest.xml 文件中 &lt; appliction &gt; 标签里 style 所设置样式为 AppTheme， 在 res/values/styles.xml 文件中找到这个样式，设置它的父样式为 <strong>BlocklyVerticalTheme</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;style name=&quot;AppTheme&quot; parent=&quot;BlocklyVerticalTheme&quot;&gt;</div><div class="line">    &lt;!-- Customize your theme here. --&gt;</div><div class="line">    ...</div><div class="line">&lt;/style&gt;</div></pre></td></tr></table></figure>
<p>（译者注：其实设置样式这步应该在导入依赖后进行，因为没导入依赖前系统中找不到 BlocklyVerticalTheme 这个样式）</p>
<h3 id="配置工程依赖"><a href="#配置工程依赖" class="headerlink" title="配置工程依赖"></a>配置工程依赖</h3><p>打开你项目工程的 build.gradle 文件，并确保它包含 JCenter 仓库。同时还要确保它包含 Android 的支持和兼容性类的 Google maven 仓库。由最新版本的 Android Studio 创建的项目文件应该已经包含了这些仓库，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">allprojects &#123;</div><div class="line">    repositories &#123;</div><div class="line">        jcenter()</div><div class="line">        maven &#123;</div><div class="line">            url &apos;https://maven.google.com&apos;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接下来，打开你应用的 build.gradle 文件，通常这个文件都在工程的 app 目录下。在依赖的模块里添加以下几行依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">compile &apos;com.android.support:appcompat-v7:26.0.1&apos;</div><div class="line">compile &apos;com.android.support:recyclerview-v7:26.0.1&apos;</div><div class="line">compile &apos;com.android.support:support-v4:26.0.1&apos;</div><div class="line">compile &apos;com.google.blockly.android:blocklylib-vertical:0.9-beta.20171003&apos;</div></pre></td></tr></table></figure>
<p>（译者注：其实关键的依赖只有最后那个 Blockly 库，其他依赖在创建工程的过程中基本都已经导入了）</p>
<blockquote>
<p><img src="http://opgrjw8x2.bkt.clouddn.com/17-10-16/85592324.jpg" alt=""> 请注意：在 JCenter 网站的 <a href="https://bintray.com/bintray/jcenter?filterByPkgName=blocklylib-core" target="_blank" rel="external"><strong>blocklylib-core</strong></a> 和 <a href="https://bintray.com/bintray/jcenter?filterByPkgName=blocklylib-vertical" target="_blank" rel="external"><strong>blocklylib-vertical</strong></a> 中查看依赖的最新版本。</p>
</blockquote>
<h3 id="实现基类-Activity"><a href="#实现基类-Activity" class="headerlink" title="实现基类 Activity"></a>实现基类 Activity</h3><p>最简单的开发一个 Android Blockly Activity 的方法就是区继承 <a href="https://github.com/google/blockly-android/blob/master/blocklylib-core/src/main/java/com/google/blockly/android/AbstractBlocklyActivity.java" target="_blank" rel="external"><strong>AbstractBlocklyActivity</strong></a>，我们强烈推荐在你第一个 Blockly  应用中使用它。这个类有如下几个抽象方法需要你来覆盖，这些抽象方法的具体实现你可以参考 <a href="https://github.com/google/blockly-android/blob/master/blocklydemo/src/main/java/com/google/blockly/android/demo/SimpleActivity.java" target="_blank" rel="external"><strong>SimpleActivity</strong></a>。</p>
<h4 id="getToolboxContentsXmlPath"><a href="#getToolboxContentsXmlPath" class="headerlink" title="getToolboxContentsXmlPath()"></a>getToolboxContentsXmlPath()</h4><p>getToolboxContentsXmlPath() 返回 assets/ 目录下定义工具箱（toolbox）内容的 XML 文件路径。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">protected String getToolboxContentsXmlPath() &#123;</div><div class="line">    return &quot;default/toolbox.xml&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p><img src="http://opgrjw8x2.bkt.clouddn.com/17-10-16/85592324.jpg" alt=""> 请注意：想了解关于工具箱（toolbox）的更多内容，请参阅「<a href="https://developers.google.cn/blockly/guides/configure/android/toolbox" target="_blank" rel="external">填充工具箱</a>」</p>
</blockquote>
<h4 id="getBlockDefinitionsJsonPaths"><a href="#getBlockDefinitionsJsonPaths" class="headerlink" title="getBlockDefinitionsJsonPaths()"></a>getBlockDefinitionsJsonPaths()</h4><p>getBlockDefinitionsJsonPaths() 返回 assets/ 目录下定义块（Block）的 .json 文件路径，以下代码实现了导入Blockly库中提供的默认块（Block）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">protected List&lt;String&gt; getBlockDefinitionsJsonPaths() &#123;</div><div class="line">    List&lt;String&gt; assetPaths = new ArrayList&lt;&gt;(DefaultBlocks.getAllBlockDefinitions());</div><div class="line">    // Append your own block definitions here.</div><div class="line">    return assetPaths;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>DefaultBlocks 类中包含了 Blockly 预定义块的帮助函数。 getAllBlockDefinitions（）返回一个所有预定义块路径的数组。从这个地方开始是容易的，尽管开发者们最终会想要选择与应用程序相关的特定块，以及特定于运行时环境的创建块。</p>
<p>关于创建新的 Blockly 块的详细信息，请参阅「<a href="https://developers.google.cn/blockly/guides/configure/android/add-custom-blocks" target="_blank" rel="external">添加自定义块</a>」。</p>
<h4 id="getGeneratorsJsPaths"><a href="#getGeneratorsJsPaths" class="headerlink" title="getGeneratorsJsPaths()"></a>getGeneratorsJsPaths()</h4><p>getGeneratorsJsPaths() 返回 assets/ 目录下定义 Blockly  块实现方法的生成器 .js 文件的路径。下面代码表示引入包括 Blockly 默认块的所有 JavaScript 实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">private static final List&lt;String&gt; JAVASCRIPT_GENERATORS = Arrays.asList(</div><div class="line">    // Custom block generators go here. Default blocks are already included.</div><div class="line">);</div><div class="line"></div><div class="line">@Override</div><div class="line">protected List&lt;String&gt; getGeneratorsJsPaths() &#123;</div><div class="line">    return JAVASCRIPT_GENERATORS;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p><img src="http://opgrjw8x2.bkt.clouddn.com/17-10-16/85592324.jpg" alt=""> 请注意：在「<a href="https://developers.google.cn/blockly/guides/configure/android/custom-generators" target="_blank" rel="external">自定义生成器</a>」中了解更多关于生成器（generators）内容。</p>
</blockquote>
<h4 id="getCodeGenerationCallback"><a href="#getCodeGenerationCallback" class="headerlink" title="getCodeGenerationCallback()"></a>getCodeGenerationCallback()</h4><p>getCodeGenerationCallback() 返回将生成的代码返回给应用的回调，这个方法在用户点击标题栏（actionbar）中的 run/play 按钮时被调用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">CodeGenerationRequest.CodeGeneratorCallback mCodeGeneratorCallback =</div><div class="line">        new LoggingCodeGeneratorCallback(this, &quot;LoggingTag&quot;);</div><div class="line"></div><div class="line">@Override</div><div class="line">protected CodeGenerationRequest.CodeGeneratorCallback getCodeGenerationCallback() &#123;</div><div class="line">    return mCodeGeneratorCallback;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在上述代码中，应用对于每次调用都使用相同的生成器回调。这种做法是常见的，但不是必须的。</p>
<h4 id="onInitBlankWorkspace"><a href="#onInitBlankWorkspace" class="headerlink" title="onInitBlankWorkspace()"></a>onInitBlankWorkspace()</h4><p>虽然不是一种抽象方法，但是如果您的应用程序包含 default / variable_blocks.json，则现在需要onInitBlankWorkspace（）来定义可用的变量。支持变量的功能目前正在开发中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">protected void onInitBlankWorkspace() &#123;</div><div class="line">    // Initialize available variable names.</div><div class="line">    getController().addVariable(&quot;item&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="下一步"><a href="#下一步" class="headerlink" title="下一步"></a>下一步</h3><p>这时候，你的应用程序应该可以编译和运行，效果类似于 SimpleActivity 。接下来，你可以从如下几个不同方面来进行进一步的开发。</p>
<ul>
<li><a href="https://developers.google.cn/blockly/guides/configure/android/customize-layout" target="_blank" rel="external">自定义活动布局</a>，为应用的导航和可视化让出空间。</li>
<li>在新的块 .json 文件中<a href="https://developers.google.cn/blockly/guides/create-custom-blocks/define-blocks" target="_blank" rel="external">定义和添加自定义块</a></li>
<li><a href="https://developers.google.cn/blockly/guides/configure/android/toolbox" target="_blank" rel="external">自定义工具箱中的类别和块</a></li>
<li><a href="https://developers.google.cn/blockly/guides/modify/android/building_and_linking" target="_blank" rel="external">从源头构建 Blockly 库，并链接 <strong>.aar</strong> 文件</a></li>
</ul>


                
            </div>

            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    


                </div>
            
        </div>
    </div>
</article>

    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    

                    

                    
                        <li>
                            <a href="https://github.com/weiyushiguang" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    

                    
                </ul>
                <p class="copyright text-muted">&copy; 2017 Owen Lee<br></p>
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->



</body>

</html>